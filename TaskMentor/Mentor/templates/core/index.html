{% extends 'core/base.html' %}

{% block title %}TaskMentor - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="hero-section">
    <div class="container">
        <h1 class="hero-title">TaskMentor</h1>
        <p class="hero-subtitle">–£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
        
        <div class="role-selection">
            <div class="role-card teacher-card" data-role="teacher">
                <div class="role-icon">üë®‚Äçüè´</div>
                <h3>–£—á–∏—Ç–µ–ª—å</h3>
                <p>–¢—Ä–µ–Ω–µ—Ä, –ö–æ—É—á, –ü—Å–∏—Ö–æ–ª–æ–≥</p>
            </div>
            
            <div class="role-card student-card" data-role="student">
                <div class="role-icon">üë®‚Äçüéì</div>
                <h3>–£—á–µ–Ω–∏–∫</h3>
                <p>–ö–ª–∏–µ–Ω—Ç</p>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <span class="close">&times</span>
        <div id="loginForm">
            <h2 id="modalTitle">–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
            <form method="post" id="authForm">
                {% csrf_token %}
                <input type="hidden" name="role" id="formRole">
                <div class="form-group">
                    <input type="email" name="email" placeholder="Email" required class="form-control mb-3">
                    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required class="form-control mb-3">
                </div>
                <button type="submit" class="btn btn-outline-primary w-100 mb-2">–í–æ–π—Ç–∏</button>
                <button type="button" onclick="goToRegister()" class="btn btn-outline-primary w-100 mb-3"
                        id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
                <a href="/accounts/google/login/" class="btn btn-danger w-70 float-end">
                    <img src="https://developers.google.com/identity/images/g-logo.png" width="20" alt="">
                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</a>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const teacherCard = document.querySelector('.teacher-card');
    const studentCard = document.querySelector('.student-card');
    const modal = document.getElementById('authModal');
    const closeBtn = document.querySelector('.close');
    const modalTitle = document.getElementById('modalTitle');
    const formRole = document.getElementById('formRole');
    const authForm = document.getElementById('authForm');
    const registerBtn = document.getElementById('registerBtn');  // –ï—Å–ª–∏ –µ—Å—Ç—å

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
    teacherCard.addEventListener('click', function() {
        modalTitle.textContent = '–£—á–∏—Ç–µ–ª—å';
        formRole.value = 'teacher';
        if (registerBtn) registerBtn.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
        modal.style.display = 'flex';
    });

    studentCard.addEventListener('click', function() {
        modalTitle.textContent = '–£—á–µ–Ω–∏–∫';
        formRole.value = 'student';
        if (registerBtn) registerBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é';
        modal.style.display = 'flex';
    });

    closeBtn.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    window.addEventListener('click', function(event) {
        if (event.target === modal) modal.style.display = 'none';
    });

    // ‚úÖ AJAX –ª–æ–≥–∏–Ω (–∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π submit)
    authForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const role = formRole.value;
        const email = this.querySelector('input[name="email"]').value;
        const password = this.querySelector('input[name="password"]').value;

        if (!role || !email || !password) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å!');
            return;
        }

        fetch('/ajax-login/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: `role=${role}&email=${email}&password=${password}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = data.redirect;
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        });
    });
});
function goToRegister() {
    const role = document.getElementById('formRole').value;
    console.log('goToRegister called, role:', role);  // ‚úÖ –î–µ–±–∞–≥
    if (role === 'teacher') {
        window.location.href = '/register/teacher/';
    } else {
        window.location.href = '/student/application/';
    }
}

<!--async function testPushFromIndex() {-->
<!--console.log('üß™ –¢–µ—Å—Ç –∏–∑ index...');-->
<!--try {-->
<!--    const resp = await fetch('/test-notification/', {method: 'POST'});-->
<!--    console.log('‚úÖ', await resp.json());-->
<!--} catch(e) { console.error('‚ùå', e); }-->
<!--}-->
</script>
{% endblock %}
